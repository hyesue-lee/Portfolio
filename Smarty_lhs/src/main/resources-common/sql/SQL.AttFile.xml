<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//ibatis.apache.org//DTD Mapper 3.0//EN"
"http://ibatis.apache.org/dtd/ibatis-3-mapper.dtd">

	<mapper namespace="com.lhs.dao.AttFileDao"> 
		
		<insert id ="addAttFile" parameterType="HashMap" >
			INSERT INTO board_attach (board_seq, board_type, file_name, fake_file_name, file_size, file_type, save_loc, create_date)
		 	VALUES (#{ boardSeq } , #{ typeSeq }, #{ fileName }, #{ fakeName }, #{ fileSize }, #{ fileType }, 'N', NOW())
		</insert>
		
	 	<select id="readAttFiles" parameterType="HashMap" resultType="HashMap">
	 		SELECT * FROM board_attach WHERE board_type = #{typeSeq} AND board_seq = #{boardSeq}
	 	</select>
	 	
	 	<select id="readAttFileByPk" parameterType="int" resultType="HashMap">
	 		SELECT * FROM board_attach WHERE file_idx = #{0}
	 	</select>
	 	
	 	<delete id ="deleteAttFile" parameterType="HashMap">
	 		DELETE FROM board_attach WHERE file_idx = #{fileIdx}
	 	</delete>
	 	<delete id ="deleteAttFileByBoard" parameterType="HashMap">
	 		DELETE FROM board_attach WHERE board_seq = #{boardSeq} AND board_type =#{typeSeq} 
	 	</delete>
	 	
	 	<select id="readAllAttFiles" resultType="HashMap">
	 	 SELECT * FROM board_attach
	 	</select>
	 	
	 	
	 	<update id="updateLinkedInfo" parameterType="int" >
	 		UPDATE board_attach 
	 		SET linked = 0 
	 		WHERE file_idx = #{fileIdx}
	 	</update>
	 	
	 	<update id="updateLinkedInfos" parameterType="List" >
	 		UPDATE board_attach 
	 		SET linked = 0 
	 		WHERE file_idx IN <!-- 여러개이면 =대신 WHERE column IN(1,3,2...)  -->
	 		<!-- foreach: 파라미터 타입이 컬렉션이면 컬렉션타입을, 맵이면 컬렌션의 key를 적어야함..  -->
	 		<!--JSP:     items               var -->
	 		<foreach collection="list" item="fileIdx" open="(" close=")" separator=",">
	 			#{fileIdx}
	 		</foreach>
	 	</update>
		
		
	</mapper>